\ProvidesPackage{style}

\usepackage{geometry}
%\geometry{heightrounded}


%Color related stuff
\usepackage[usenames,dvipsnames]{xcolor}
\definecolor{darkblue}{RGB}{0,0,90}
\definecolor{darkgreen}{RGB}{0,80,0}
\definecolor{gray75}{gray}{0.8}


%Image captions
%\usepackage[format=hang]{caption}
\usepackage{caption}
\renewcommand{\captionlabelfont}{\fontfamily{phv}\selectfont\bfseries\small}


%links and urls (internal AND external)
\usepackage{hyperref}
\usepackage{url}
\hypersetup{colorlinks=true,pdfborder={0 0 0},citecolor=darkblue,linkcolor=darkblue,urlcolor=darkblue}


\usepackage[varg]{txfonts}


%Titles of content
\usepackage{tocloft}
\setcounter{tocdepth}{3}

\renewcommand{\cftdot}{\textcolor[gray]{0.75}{--}}
\renewcommand{\cftdotsep}{0}
\renewcommand{\cftchapfont}{\fontfamily{phv}\selectfont\bfseries}
\renewcommand{\contentsname}{C \hsp \textcolor[gray]{0.75}{ \rule[-0.75ex]{0.08ex}{1.5em} }\hsp Contents}



%Margin notes
\usepackage{marginnote,letltxmacro}
\usepackage{etoolbox}

%\renewcommand*{\raggedleftmarginnote}{\centering}
\renewcommand*{\marginnoteleftadjust}{12.4cm}

\renewcommand*{\marginfont}{\footnotesize}
\LetLtxMacro\mnote\marginnote


%symbols for footnotes
\usepackage[symbol*, perpage]{footmisc}
%\newcommand{\mfootnote}{\fnsymbol{footnote}}
\makeatletter
\def\@xfootnote[#1]{%
  \protected@xdef\@thefnmark{#1}%
  \@footnotemark\@footnotetext}
\makeatother




%Double column footnotes
\usepackage{dblfnote}
\DFNalwaysdouble % for this example


% Quotes
\usepackage{csquotes}


%Some baseline lengths for styles
\def\hsp{\hspace{10pt}}
\def\dsp{\hspace{20pt}}


%Defining titles with fancy fonts
\usepackage[compact]{titlesec}
\titleformat{\section}[hang]{\fontfamily{phv}\selectfont\bfseries}{\thesection\hsp}{0pt}{}{}
\titleformat{\subsection}[hang]{\fontfamily{phv}\selectfont}{\thesubsection\hsp}{0pt}{}{}
\titleformat{\subsubsection}[hang]{\small\fontfamily{phv}\selectfont\itshape}{\hsp}{0pt}{}{}

\titleformat{\chapter}[hang]{\Huge\fontfamily{phv}\selectfont}{\thechapter\hsp{\textcolor{gray75}{\rule[-0.75ex]{0.08ex}{1.5em}}}\hsp}{0pt}{\huge\bfseries}{}

\titleformat{name=\chapter,numberless}[display]{\Huge\fontfamily{phv}\selectfont\filcenter}{}{1ex}{\vspace{-6cm}}[\vspace{1ex}]



\newcommand*{\titlefont}{\Huge\fontfamily{phv}\selectfont\bfseries}



% page headers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}

\renewcommand{\headrulewidth}{0pt}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.0pt}
\renewcommand{\chaptermark}[1]{\markboth{\fontfamily{phv}\selectfont\chaptername\ \thechapter:\ #1}{}}
\fancyhead[LE]{\fontfamily{phv}\selectfont \leftmark}
\fancyhead[RE]{}
\fancyhead[LO]{}
\fancyhead[RO]{\fontfamily{phv}\selectfont \nouppercase\rightmark}
\renewcommand{\sectionmark}[1]{\markright{\arabic{chapter}.\arabic{section} \, #1}}





%-------------------------------------------------- 
\usepackage{tikz}% mandatory for the \chapterImage command
%\newcommand\chapterimage[2][]{
%  \begin{tikzpicture}[overlay,
%      picture/.style={anchor=north east,rectangle,inner sep=0pt,outer sep=0pt, shift={(-4cm, -2cm)}}]
%     \node[picture] at (\textwidth,9cm){\includegraphics[#1]{#2}};
%  \end{tikzpicture}
%}
\newcommand\chapterimage[2][]{
  \begin{tikzpicture}[overlay,
      picture/.style={anchor=east,rectangle, shift={(0.0cm, -4cm)}}]
     \node[picture] at (\textwidth,9cm){\includegraphics[#1]{#2}};
  \end{tikzpicture}
}

%-------------------------------------------------- 
%Citation formatting
\usepackage[style=numeric, 
            backend=biber,
            mincitenames=1,
            maxcitenames=3,
            maxbibnames=100,
            backref=true, 
            sorting=none]{biblatex}

\input{journals}

\renewbibmacro{in:}{}
\renewcommand*{\finalnamedelim}{\addspace\&\space}

%\renewcommand{\footnotesize}{\scriptsize}


\DeclareFieldFormat[article]{year}{(#1)}
\DefineBibliographyStrings{english}{andothers={\emph{et al}\adddot}}

\DeclareCiteCommand{\cite}[\mkbibfootnote]
{\usebibmacro{prenote}}{
    \usebibmacro{citeindex}
    \mkbibbrackets{\usebibmacro{cite}}
    \setunit{\addnbspace}
    \printnames[labelname]{author}
    \setunit{\labelnamepunct}
    %\printfield{journaltitle}
    \newunit
    \printfield[parens]{year}
}
{\addsemicolon\par\hspace{1.1em}}
{\usebibmacro{postnote}}


%{\addsemicolon\space\par}

%\makeatletter
%\renewcommand{\@makefntext}[1]{%
%  \setlength{\parindent}{0pt}%
%  \begin{list}{}{\setlength{\labelwidth}{1.5em}%
%    \setlength{\leftmargin}{\labelwidth}%
%    \setlength{\labelsep}{3pt}%
%    \setlength{\itemsep}{0pt}%
%    \setlength{\parsep}{0pt}%
%    \setlength{\topsep}{0pt}%
%%   \setlength{\rightmargin}{0.2\textwidth}%
%    \footnotesize}%
%    \item[\@makefnmark\hfil]#1%
%  \end{list}%
%}
%\makeatother


%Separate driver for the bibliography listing
\DeclareBibliographyDriver{article}{
\usebibmacro{bibindex}
\usebibmacro{begentry}
\newunit\newblock
\printnames{author}
\newunit\newblock
\usebibmacro{journal}
\newunit\newblock
\printfield{volume}
\newunit\newblock
\printfield{number}
\newunit\newblock
\usebibmacro{note+pages}
\newunit\newblock
\printfield{year}
\newunit\newblock
\usebibmacro{pageref}
\newline\newblock
\printfield{title}
{\iffieldundef{doi}{
    {\iffieldundef{url}
    {}
    {\newline\newblock
    \usebibmacro{doi+eprint+url}}
    {}
    }
}
{\newline\newblock
\usebibmacro{doi+eprint+url}}
{}
}
\finentry}

\DefineBibliographyStrings{english}{
backrefpage = {see p.},
backrefpages = {see pp.},
}


\renewbibmacro*{doi+eprint+url}{
\iftoggle{bbx:doi}
{\iffieldundef{url}{\printfield{doi}}{}}{}
\iftoggle{bbx:eprint}
{\iffieldundef{doi}{\usebibmacro{eprint}}{}}{}
\iftoggle{bbx:url}
{\usebibmacro{url+urldate}}{}
}






